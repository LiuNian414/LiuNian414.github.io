<!DOCTYPE html>
<html>
<head>
    <title>é€†æ°´å¯’å¸®æˆ˜BIç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* å®Œæ•´æ ·å¼è¡¨ */
        :root { --primary: #2c3e50; --secondary: #3498db; }
        body { font-family: 'Segoe UI', sans-serif; max-width: 1280px; margin: 0 auto; padding: 20px; }
        
        /* ä¸»å®¹å™¨æ”¹ä¸º3åˆ—å¸ƒå±€ */
        .main-container { 
            display: grid; 
            grid-template-columns: 300px 1fr 1fr; 
            gap: 20px; 
            align-items: start;
        }
        
        /* è¾“å…¥åŒºåŸŸæ ·å¼ */
        .input-section { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            grid-column: 1;
        }
        
        /* æ•°æ®è¡¨æ ¼åŒºåŸŸæ ·å¼ */
        .data-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            grid-column: 2 / span 2;
            overflow-x: auto;
        }
        
        /* å›¾è¡¨åŒºåŸŸæ ·å¼ */
        .charts { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-top: 30px; 
            grid-column: 1 / span 3;
        }
        
        .chart-container { height: 500px; border: 1px solid #eee; border-radius: 8px; padding: 15px; }
        
        /* è¾“å…¥è¡Œæ ·å¼ */
        .input-row { margin: 12px 0; display: grid; grid-template-columns: 100px 1fr; align-items: center; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: var(--secondary); color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; }
        
        /* è¡¨æ ¼æ ·å¼ */
        #battleTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        #battleTable th, #battleTable td {
            padding: 12px;
            border: 1px solid #eee;
            text-align: left;
        }
        #battleTable th[contenteditable] {
            background: #f8f9fa;
            min-width: 120px;
        }
        
        /* è¾“å…¥ç½‘æ ¼æ ·å¼ */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
            margin: 15px 0;
            padding: 10px;
            background: #fff;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .special-fields [data-class] {
            display: none;
        }
        
        /* æŒ‰é’®åŒºåŸŸæ ·å¼ */
        .button-area {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            grid-column: 1 / span 3;
        }
    </style>
</head>
<body>
    <h1>é€†æ°´å¯’å¸®æˆ˜åˆ†æç³»ç»Ÿ</h1>
    let rawBattleData = [];
    <div class="main-container">
        <!-- å·¦ä¾§è¾“å…¥åŒºåŸŸ -->
        <div class="input-section">
            <!-- æ–°å¢æ—¥æœŸå’Œå¯¹å±€åç§°è¾“å…¥ -->
            <div class="input-row">
                <label>æˆ˜æ–—æ—¥æœŸ</label>
                <input type="date" id="battleDate" required>
            </div>
            <div class="input-row">
                <label>å¯¹å±€åç§°</label>
                <input type="text" id="battleName" required>
            </div>

            <!-- åŸºç¡€ä¿¡æ¯ -->
            <div class="input-grid">
                <div class="input-row">
                    <label>ç©å®¶åç§°</label>
                    <input type="text" id="playerName" required>
                </div>
                <div class="input-row">
                    <label>ç­‰çº§</label>
                    <input type="number" id="level" min="1" max="90" required>
                </div>
                <div class="input-row">
                    <label>èŒä¸š</label>
                    <select id="playerClass" onchange="toggleSpecialFields()">
                        <option value="ç´ é—®">ç´ é—®</option>
                        <option value="é“è¡£">é“è¡£</option>
                        <option value="ç¢æ¢¦">ç¢æ¢¦</option>
                        <option value="è¡€æ²³">è¡€æ²³</option>
                        <option value="é¾™åŸ">é¾™åŸ</option>
                        <option value="ä¹çµ">ä¹çµ</option>
                        <option value="ç¥ç›¸">ç¥ç›¸</option>
                        <option value="ç„æœº">ç„æœº</option>
                        <option value="ç ´é“">ç ´é“</option>
                        <option value="å¤©é—®">å¤©é—®</option>
                        <option value="æ½®å…‰">æ½®å…‰</option>
                    </select>
                </div>
            </div>

            <!-- æˆ˜æ–—æ•°æ® -->
            <div class="input-grid">
                <div class="input-row">
                    <label>å‡»è´¥æ•°</label>
                    <input type="number" id="kills" min="0" required>
                </div>
                <div class="input-row">
                    <label>åŠ©æ”»æ•°</label>
                    <input type="number" id="assists" min="0" required>
                </div>
                <div class="input-row">
                    <label>æˆ˜å¤‡èµ„æº</label>
                    <input type="number" id="resources" min="0" required>
                </div>
                <div class="input-row">
                    <label>å¯¹ç©å®¶ä¼¤å®³</label>
                    <input type="number" id="playerDamage" min="0" required>
                </div>
                <div class="input-row">
                    <label>å¯¹å»ºç­‘ä¼¤å®³</label>
                    <input type="number" id="buildingDamage" min="0" required>
                </div>
                <div class="input-row">
                    <label>æ²»ç–—å€¼</label>
                    <input type="number" id="heal" min="0">
                </div>
                <div class="input-row">
                    <label>æ‰¿å—ä¼¤å®³</label>
                    <input type="number" id="damageTaken" min="0" required>
                </div>
                <div class="input-row">
                    <label>é‡ä¼¤æ¬¡æ•°</label>
                    <input type="number" id="deaths" min="0" required>
                </div>
            </div>

            <!-- èŒä¸šç‰¹æ®Šå­—æ®µ -->
            <div class="input-grid special-fields">
                <div class="input-row" data-class="ç´ é—®">
                    <label>åŒ–ç¾½æ¬¡æ•°</label>
                    <input type="number" id="revive" min="0">
                </div>
                <div class="input-row" data-class="æ½®å…‰">
                    <label>æ¸…æ³‰æ¬¡æ•°</label>
                    <input type="number" id="spring" min="0">
                </div>
                <div class="input-row" data-class="ä¹çµ">
                    <label>ç„šéª¨æ¬¡æ•°</label>
                    <input type="number" id="boneBurn" min="0">
                </div>
                <div class="input-row">
                    <label>æ‰€åœ¨å›¢é•¿</label>
                    <input type="text" id="teamLeader" required>
                </div>
                <div class="input-row">
                    <label>èŒä¸šç³»æ•°</label>
                    <input type="number" id="classFactor" step="0.01" min="0.5" max="2.0" required>
                </div>
            </div>
        </div>

        <!-- å³ä¾§æ•°æ®è¡¨æ ¼åŒºåŸŸ -->
        <div class="data-section">
            <table id="battleTable">
                <thead>
                    <tr>
                        <th style="width:30px">âœ“</th>
                        <th>æˆ˜æ–—æ—¥æœŸ</th>
                        <th>å¯¹å±€åç§°</th>
                        <th>ç©å®¶åç§°</th>
                        <th>èŒä¸š</th>
                        <th>å‡»è´¥æ•°</th>
                        <th>åŠ©æ”»æ•°</th>
                        <th>æˆ˜å¤‡èµ„æº</th>
                        <th>å¯¹ç©å®¶ä¼¤å®³</th>
                        <th>å¯¹å»ºç­‘ä¼¤å®³</th>
                        <th>æ²»ç–—å€¼</th>
                        <th>æ‰¿å—ä¼¤å®³</th>
                        <th>é‡ä¼¤æ•°</th>
                        <th>åŒ–ç¾½/æ¸…æ³‰æ¬¡æ•°</th>
                        <th>æ‰€åœ¨å›¢é•¿</th>
                    </tr>
                </thead>
                <tbody id="battleDataBody">
                    <!-- æ•°æ®è¡Œç¤ºä¾‹ -->
                    <tr>
                        <td><input type="checkbox"></td>
                        <td>2023-08-15</td>
                        <td>æ±´äº¬å†³æˆ˜</td>
                        <td>å‰‘ä¾ æƒ…ç¼˜</td>
                        <td>ç´ é—®</td>
                        <td>5</td>
                        <td>12</td>
                        <td>260</td>
                        <td>36000</td>
                        <td>80000</td>
                        <td>15000</td>
                        <td>80000</td>
                        <td>7</td>
                        <td>7</td>
                        <td>è‰¯å“¥</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æŒ‰é’®åŒºåŸŸ -->
        <div class="button-area">
            <button onclick="submitData()" style="background:#4CAF50">ğŸ”„æäº¤</button>
            <button onclick="analyzeSelected()" style="background:#2196F3">ğŸ”åˆ†æé€‰ä¸­é¡¹</button>
        </div>

        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="charts">
            <div class="chart-container" id="damageChart"></div>
            <div class="chart-container" id="contributionChart"></div>
        </div>
    </div>

    <script>
        // èŒä¸šç³»æ•°é»˜è®¤å€¼æ˜ å°„
        const CLASS_FACTORS = {
            'ç´ é—®': 0.95,
            'é“è¡£': 1.0,
            'ç¢æ¢¦': 1.2,
            'è¡€æ²³': 0.95,
            'é¾™åŸ': 1.0,
            'ä¹çµ': 1.0,
            'ç¥ç›¸': 1.0,
            'ç„æœº': 1.0,
            'ç ´é“': 1.1,
            'å¤©é—®': 1.0,
            'æ½®å…‰': 0.95
        };

        // åŠ¨æ€æ˜¾ç¤ºèŒä¸šç‰¹æ®Šå­—æ®µ
        function toggleSpecialFields() {
            const selectedClass = document.getElementById('playerClass').value;
            document.querySelectorAll('.special-fields [data-class]').forEach(field => {
                field.style.display = field.dataset.class === selectedClass ? 'flex' : 'none';
            });
            
            // è‡ªåŠ¨å¡«å……èŒä¸šç³»æ•°
            document.getElementById('classFactor').value = CLASS_FACTORS[selectedClass];
        }

        // æ•°æ®æ”¶é›†
        function collectInputData() {
        return {
        date: document.getElementById('battleDate').value || new Date().toISOString().split('T')[0],
        battleName: document.getElementById('battleName').value.trim() || "æœªå‘½åå¯¹å±€",
        player: document.getElementById('playerName').value.trim(),
        class: document.getElementById('playerClass').value,
        kills: parseInt(document.getElementById('kills').value) || 0,
        assists: parseInt(document.getElementById('assists').value) || 0,
        resources: parseInt(document.getElementById('resources').value) || 0,
        playerDamage: parseInt(document.getElementById('playerDamage').value) || 0,
        buildingDamage: parseInt(document.getElementById('buildingDamage').value) || 0,
        heal: parseInt(document.getElementById('heal').value) || 0,
        damageTaken: parseInt(document.getElementById('damageTaken').value) || 0,
        deaths: parseInt(document.getElementById('deaths').value) || 0,
        revive: parseInt(document.getElementById('revive').value) || 0,
        spring: parseInt(document.getElementById('spring').value) || 0,
        boneBurn: parseInt(document.getElementById('boneBurn').value) || 0,
        teamLeader: document.getElementById('teamLeader').value.trim(),
        classFactor: parseFloat(document.getElementById('classFactor').value) || 1.0
    };
}
         // æäº¤æ•°æ®
function submitData() {
    const formData = collectInputData();
    saveToLocalStorage(formData);
    rawBattleData = loadFromLocalStorage(); // é‡æ–°åŠ è½½æ•°æ®
    updateDataTable(); // æ›´æ–°è¡¨æ ¼å†…å®¹
    console.log("å½“å‰æ•°æ®:", rawBattleData); // è°ƒè¯•è¾“å‡º
}
 
       // æ›´æ–°è¡¨æ ¼
function updateDataTable() {
    const tbody = document.getElementById('battleDataBody');
    tbody.innerHTML = rawBattleData.map((data, index) => `
        <tr>
            <td><input type="checkbox" id="check${index}"></td>
            <td>${data.date}</td>
            <td>${data.battleName}</td>
            <td>${data.player}@${data.class}</td>
            <td>${data.kills}</td>
            <td>${data.assists}</td>
            <td>${data.resources}</td>
            <td>${data.playerDamage}</td>
            <td>${data.buildingDamage}</td>
            <td>${data.heal}</td>
            <td>${data.damageTaken}</td>
            <td>${data.deaths}</td>
            <td>${data.revive || data.spring || data.boneBurn || '-'}</td>
            <td>${data.teamLeader}</td>
        </tr>
    `).join('');
}
  document.addEventListener('DOMContentLoaded', () => {
    rawBattleData = loadFromLocalStorage();
    updateDataTable();  // ç¡®ä¿è¡¨æ ¼æ­£ç¡®æ¸²æŸ“
});
        
// ä¿å­˜æ•°æ®åˆ°localStorage
function saveToLocalStorage(data) {
    const savedData = JSON.parse(localStorage.getItem('battleData') || '[]');
    savedData.push(data);
    localStorage.setItem('battleData', JSON.stringify(savedData));
}

// ä»localStorageåŠ è½½æ•°æ®
function loadFromLocalStorage() {
    return JSON.parse(localStorage.getItem('battleData') || '[]');
}

// ä¿®æ”¹submitDataå‡½æ•°
function submitData() {
    const formData = collectInputData();
    saveToLocalStorage(formData);
    rawBattleData = loadFromLocalStorage();
    updateDataTable();
}

// é¡µé¢åŠ è½½æ—¶
document.addEventListener('DOMContentLoaded', () => {
    rawBattleData = loadFromLocalStorage();
    updateDataTable();
});
        
        // ğŸ†•åˆ†æé€‰ä¸­é¡¹åŠŸèƒ½
        function analyzeSelected() {
            const selectedIndexes = [...document.querySelectorAll('input[type="checkbox"]')]
                .map((checkbox,index) => checkbox.checked ? index : -1)
                .filter(i => i >= 0);

            selectedIndexes.forEach(index => {
                const data = rawBattleData[index];
                const score = calculateScore(data); // è°ƒç”¨è®¡ç®—å…¬å¼
                alert(`[${data.battleName}] ${data.player} å¾—åˆ†ï¼š${score.toFixed(2)}`);
            });
        }

        // è®¡ç®—å…¬å¼å°è£…
        function calculateScore(data) {
            // æ ¹æ®èŒä¸šè°ƒç”¨ä¸åŒå…¬å¼
            const formula = classFormulas[data.class];
            return formula ? formula(data) : 0;
        }
    </script>
<style>
/* å¢å¼ºæ ·å¼ */
.input-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 12px;
    margin: 15px 0;
    padding: 10px;
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.input-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.special-fields [data-class] {
    display: none;
}

input[type="number"] {
    width: 100px;
}

select {
    width: 150px;
}
</style>
</body>
</html>
